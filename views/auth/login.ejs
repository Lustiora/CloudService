<div class="row my-5 justify-content-center">
  <div class="col-8 col-md-6 col-lg-4">
    <h3 class="text-center mb-5">Login</h3>
    <form id="frm" method="post">
      <div class="input-group my-2">
        <div class="input-group-text">Email</div>
        <input class="form-control" id="email" value="perican@cosmo.net" />
      </div>
      <div class="input-group">
        <div class="input-group-text">Password</div>
        <input class="form-control" id="password" type="password" value="qwer1234" />
      </div>
      <div class="my-3">
        <button type="submit" class="btn btn-success w-100">Login</button>
      </div>
      <div class="my-3">
        <button id="google" type="button" class="btn btn-primary w-100">Google</button>
      </div>
      <div class="my-3">
        <button onclick="handleNaverLogin(event)" type="button" class="btn btn-secondary w-100">Naver</button>
      </div>
      <div class="text-end mt-3">
        <span id="join">
          <a href="/users/join">Sign Up</a>
        </span>
        <span id="profile" style="display: none">
          <a href="/profile">Edit</a>
        </span>
      </div>
    </form>
    <div class="my-3">
      <button onclick="handleKakaoLogin(event)" style="border: none; background: none; padding: 0; outline: none;">
        <img src="/images/kakao/kakao_login_medium_wide.png" alt="카카오로그인"/>
      </button>
    </div>
  </div>
</div>
<script type="module">
  //type module이면 esm이다.(ECMAScript Modules)
  //그런데 package.json파일에는 type이 commonjs로 설정됨
  //한 파일안에서 cjs와 esm은 섞어쓸 수 없다.(a.cjs, b.mjs)
  import { app } from '/javascripts/firebase.js'
  import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js'
  const auth = getAuth(app)
  console.log(auth);
  //<form id="frm" method="post">
  const frm = document.querySelector('#frm')
  frm.addEventListener('submit', function(event){
    //submit 이슈해결 하기 위해 아래 코드 추가함
    event.preventDefault()
    const email = document.querySelector('#email').value;//kiwi@hot.com
    //insert here
    const password = document.querySelector('#password').value//12345678
    console.log(`사용자가 입력한 이메일 ${email}, 비번: ${password}`);//kiwi@hot.com
    // Firebase에서 제공되는 메서드이다.
    // Parameter = 3
    // Firebase서버를 경유 - 지연이 발생할 수 도 있다. - waiting
    // 그런데 Javascript는 동기적으로 처리 - 디폴트
    signInWithEmailAndPassword(auth, email, password)
    //signInWithEmailAndPassword메서드 요청했을 때 firebase에서 파라미터 자리인
    //userCredential에 인증된 정보를 주입해줌
    .then((data) => { // 요청에 대한 응답이 오면 ~ Parameter Data변수에 사용자 정보가 담김
      // 요청이 정상이면 서버로 부터 data변수에 정보를 돌려받는다. - 콜백함수
      // Signed in 
      try {
        const user = data.user;
        console.log(user.uid);
        console.log(user.email);
        if(user.uid){ // 참이면 구글에서 응답으로 보내준 uid 값이 있다.
          window.localStorage.setItem("uid",user.uid)
          window.localStorage.setItem("email",user.email)
          // 로그인 성공시 homepage를 응답으로 보기전에 UI변경하기
          document.querySelector("#login").style.display = 'none'
          document.querySelector("#logout").style.display = 'block'
          location.href="/"
        }else{
          console.log("Not Login");
        }        
      } catch (error) {
        console.error('로그인 실패',error);
      }
      // const user = data.user;
      // console.log(user.uid);
      // console.log(user.email);
      // if(user.uid){ // 참이면 구글에서 응답으로 보내준 uid 값이 있다.
      //   window.localStorage.setItem("uid",user.uid)
      //   window.localStorage.setItem("email",user.email)
      //   location.href="/"
      // }else{
      //   console.log("Not Login");
      // }
      // ...
    })
    .catch((error) => {
      const errorCode = error.code;
      const errorMessage = error.message;
    });

  });//end of 폼 전송 이벤트 처리
</script>